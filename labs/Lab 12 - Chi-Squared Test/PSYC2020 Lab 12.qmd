---
title: "Chi-Squared Test"
subtitle: "PSYC 2020-A01 / PSYC 6022-A01 | 2025-11-07 | Lab 12"
author: "Jessica Helmer"
format: 
  revealjs:
    slide-number: true
    show-slide-number: all
    css: PSYC2020L_styles.css
    preview-links: true
engine: knitr
webr:
  packages:
    - rio
    - datasets
execute:
  echo: true
width: 1200
cache: true
---

## Outline

* Chi-Squared ($\chi^2$) Test

Learning objectives: 

**R**: $\chi^2$ Tests

```{r}
#| echo: false
library(tidyverse)
library(gt)
```


## Chi-Squared ($\chi^2$) Test

Testing inferences about proportions

[○ Involve categorical variables]{.subpoint}

Comparing observed frequencies (counts) to some expected (null hypothesis) frequencies

**$\chi^2$ Test of Proportions**: expected frequencies are set by researcher (e.g., null hypothesis is equal frequencies across all groups)

**$\chi^2$ Test of Independence**: expected frequencies are those implied by independence


## Chi-Squared ($\chi^2$) Test

Instead of a continuous variable, our outcome is a **count**

:::: {.columns}
::: {.column width="50%"}
Continuous

* Height

* Petal length

* Test score

:::

::: {.column width="50%"}
Counts

* Coin flip being heads

* Number of pets

* Goals scored

Only integers

:::
::::


## $\chi^2$ Test of Proportions

Do the observed frequencies of a categorical variable differ from what expected *a priori*?

Typically, this expectation is equal occurrence across groups (but doesn't have to be)

If equal occurrence, what would be our expected frequencies?

:::: {.columns}
::: {.column width="50%"}
100 coin flips

| Heads | Tails |
|-------|-------|
| 50    | 50    |
:::

::: {.column width="50%"}
Favorite primary color of 33 students

| Red | Blue | Yellow |
|-----|------|--------|
| 11  | 11   | 11     |
:::
::::

[Can also hypothesize proportions and convert to frequencies once you have a sample size]{.fragment}


## $\chi^2$ Test of Proportions: Hypotheses

$H_0$: Observed data match the expected frequencies for the population

$H_A$: Observed data do not match the expected frequencies for the population

[○ Observed frequency is either significantly lower / higher than expected]{.subpoint}

$H_0$: $p_j – \pi_j = 0$  for all categories $j$; difference for all categories is 0, where

[$p_j$ = sample (observed) proportion]{.subpoint}

[$\pi_j$ = expected (population) proportion]{.subpoint}

$H_A$: $p_j – \pi_j \neq 0$ for all categories $j$


## $\chi^2$ Test of Proportions Generally

$$ \chi^2 = \sum_{j=0}^{J} \frac{(y_j – N\pi_j)^2}{N\pi_j} = \sum_{j=0}^{J} \frac{(y_j – m_j)^2}{m_j} $$

where 

[$y_j$ = observed frequency]{.subpoint}

[$N$ = total sample size]{.subpoint}

[$m_j$ = expected frequency]{.subpoint}

*The sum of the squared differences between the observed and expected frequencies, divided by the expected frequency, for each group.*


## $\chi^2$ Test of Proportions Generally

$\text{df} = J - 1$, where

[$J$ = number of categories]{.subpoint}

Use to identify critical $\chi^2$ value from $\chi^2$ table, R, etc.

For $\chi^2$, as $\text{df}$ increases, so does the critical-$\chi^2$ value (at same $\alpha$)

Only ever a one-tailed test! For the upper end of the distribution.


## $\chi^2$ Distribution

```{r}
#| echo: false
#| fig-align: center
data.frame(i = seq(1, 35, length.out = 1000)) |>
  mutate(chi1 = dchisq(i, 1),
         chi2 = dchisq(i, 2),
         chi4 = dchisq(i, 4),
         chi8 = dchisq(i, 8),
         chi16 = dchisq(i, 16)) |>
  ggplot(aes(x = i)) +
  geomtextpath::geom_textline(aes(y = chi1, label = "chi^{2}*'(df=1)'"), parse = T,
                              hjust = .14, size = 6, linewidth = 1.5, color = "skyblue",
                              padding = unit(15, "points")) +
  geomtextpath::geom_textline(aes(y = chi2, label = "chi^{2}*'(df=2)'"), parse = T,
                              hjust = .4, size = 6, linewidth = 1.5, color = "steelblue",
                              padding = unit(15, "points")) +
  geomtextpath::geom_textline(aes(y = chi4, label = "chi^{2}*'(df=4)'"), parse = T,
                              hjust = .5, size = 6, linewidth = 1.5, color = "steelblue4",
                              padding = unit(15, "points")) +
  geomtextpath::geom_textline(aes(y = chi8, label = "chi^{2}*'(df=8)'"), parse = T,
                              hjust = .7, size = 6, linewidth = 1.5, color = "royalblue4",
                              padding = unit(15, "points")) +
  geomtextpath::geom_textline(aes(y = chi16, label = "chi^{2}*'(df=16)'"), parse = T,
                              hjust = .7, size = 6, linewidth = 1.5, color = "navy",
                              padding = unit(15, "points")) +
  scale_x_continuous(breaks = c(1, 10, 20, 30, 35)) +
  coord_cartesian(clip = "off", xlim = c(1, 35), expand = F) +
  guides(y = "none", x = guide_axis(cap = T)) +
  labs(x = NULL, y = NULL) +
  theme_classic(base_size = 16) 
```


## $\chi^2$ Test of Proportions Cutoffs

:::: {.columns}
::: {.column width="50%"}
Cutoff for test of heads vs. tails count

$J =$ 2

$\text{df} = J - 1 =$ 1

```{r}
qchisq(.95, 1)

qchisq(.05, 1, lower.tail = F)
```
:::

::: {.column width="50%"}
Cutoff for test of favorite color in the rainbow count

$J =$ 7 (ROYGBIV)

$\text{df} = J - 1 =$ 6

```{r}
qchisq(.95, 6)

qchisq(.05, 6, lower.tail = F)
```
:::
::::


## $\chi^2$ Test of Proportions Example

You are an education psychologist interested in college students' choice of majors. You've grouped majors into five categories: STEM, Social Sciences, Humanities, Arts, and Business. You'd like to test whether there are differences in the population of students choosing those majors. You sample 100 students and ask what major they chose.

[First, what are your expected frequencies for each category?]{.fragment}

```{r}
#| echo: false
data.frame(type = c("Expected", "Observed"),
           STEM = c(NA, NA),
           `Social Sciences` = c(NA, NA),
           Humanities = c(NA, NA),
           Arts = c(NA, NA), 
           Business = c(NA, NA)) |>
  gt(rowname_col = "type") |>
  cols_label(`Social.Sciences` = "Social Sciences") |>
  tab_style(style = cell_text(weight = "bold"),
              locations = cells_column_labels()) |>
  sub_missing(missing_text = "")
```


## $\chi^2$ Test of Proportions Example

You are an education psychologist interested in college students' choice of majors. You've grouped majors into five categories: STEM, Social Sciences, Humanities, Arts, and Business. You'd like to test whether there are differences in the population of students choosing those majors. You sample 100 students and ask what major they chose.

[Next, what is your $\chi^2$ cutoff value?]{.fragment}

```{r}
#| echo: false
data.frame(type = c("Expected", "Observed"),
           STEM = c(20, NA),
           `Social Sciences` = c(20, NA),
           Humanities = c(20, NA),
           Arts = c(20, NA), 
           Business = c(20, NA)) |>
  gt(rowname_col = "type") |>
  cols_label(`Social.Sciences` = "Social Sciences") |>
  tab_style(style = cell_text(weight = "bold"),
              locations = cells_column_labels()) |>
  sub_missing(missing_text = "")
```

::: fragment
```{r}
df <- 5 - 1
chisq_crit <- qchisq(.95, df)
chisq_crit
```
:::


## $\chi^2$ Test of Proportions Example

You are an education psychologist interested in college students' choice of majors. You've grouped majors into five categories: STEM, Social Sciences, Humanities, Arts, and Business. You'd like to test whether there are differences in the population of students choosing those majors. You sample 100 students and ask what major they chose.

Here are the observed values:

```{r}
#| echo: false
data.frame(type = c("Expected", "Observed"),
           STEM = c(20, 65),
           `Social Sciences` = c(20, 10),
           Humanities = c(20, 5),
           Arts = c(20, 5), 
           Business = c(20, 15)) |>
  gt(rowname_col = "type") |>
  cols_label(`Social.Sciences` = "Social Sciences") |>
  tab_style(style = cell_text(weight = "bold"),
              locations = cells_column_labels()) |>
  sub_missing(missing_text = "")
```


## $\chi^2$ Test of Proportions Example

$$ \chi^2 = \sum_{j=0}^{J} \frac{(y_j – N\pi_j)^2}{N\pi_j} = \sum_{j=0}^{J} \frac{(y_j – m_j)^2}{m_j} $$

```{r}
obs_chisq <- (65 - 20)^2 / 20 +
  (10 - 20)^2 / 20 +
  (5 - 20)^2 / 20 +
  (5 - 20)^2 / 20 +
  (15 - 20)^2 / 20
obs_chisq

obs_chisq > chisq_crit
```

[We can reject the null in favor of the alternative that the number of students is not the same across majors.]{.fragment}

## $\chi^2$ Test of Proportions R Function

:::: {.columns}
::: {.column width="50%"}
```{r}
majordat <- data.frame(major = c("STEM", "Social.Sciences", "Humanities", "Arts", "Business"),
           observed = c(65, 10, 5, 5, 15))

chisq <- majordat |>
  select(observed) |>
  chisq.test()
chisq
```
:::

::: {.column width="50%"}
```{r}
chisq$expected

chisq$statistic

chisq$p.value
```
:::
::::


## $\chi^2$ Test of Proportions Example

Let's restart and say that you were a educational psychologist interested in how students in STEM schools choose their major. In this situation, you had expected more students to select a STEM major than other majors.

These are your expected frequencies (60% STEM, evenly divided across the rest):

```{r}
#| echo: false
data.frame(type = c("Expected", "Observed"),
           STEM = c(60, 65),
           `Social Sciences` = c(10, 10),
           Humanities = c(10, 5),
           Arts = c(10, 5), 
           Business = c(10, 15)) |>
  gt(rowname_col = "type") |>
  cols_label(`Social.Sciences` = "Social Sciences") |>
  tab_style(style = cell_text(weight = "bold"),
              locations = cells_column_labels()) |>
  sub_missing(missing_text = "")
```


## $\chi^2$ Test of Proportions R Function

:::: {.columns}
::: {.column width="50%"}
```{r}
chisq.test(x = c(65, 10, 5, 5, 15), p = c(60, 10, 10, 10, 10), rescale.p = T)

chisq.test(x = c(65, 10, 5, 5, 15), p = c(.60, .10, .10, .10, .10))
```
:::

::: {.column width="50%"}
[○ `x` = data of frequencies]{.subpoint}

[○ `p` = expected probabilities]{.subpoint}

[○ `rescale.p` = [`T`/`F`], will rescale `p` to probabilities if you prefer to input frequencies]{.subpoint}
:::
::::


## $\chi^2$ Test of Independence

Do the observed frequencies of a categorical variable differ from what expected via properties of independence?

[○ Now considering more than one type of category]{.subpoint}

* Number of pets by both cat vs. dog people and undergrad vs. post-graduate

Sets up an (at least) 2x2 contingency table

|               | Cat Person | Dog Person |
|---------------|------------|------------|
| Undergrad     |            |            | 
| Post-Graduate |            |            |

Calculate the expected frequencies from the marginal totals of the contingency table
[○ Expected values determined from data]{.subpoint}


## $\chi^2$ Test of Independence: Hypotheses

$H_0$: Categorical Variable 1 and Categorical Variable 2 have no association (i.e., are independent)

$H_A$: Categorical Variable 1 and Categorical Variable 2 have some association (i.e., are not independent)

[○ Testing whether expected frequencies match those expected by properties of independence]{.subpoint}

The same: 

$H_0$: $p_j – \pi_j = 0$  for all categories $j$; difference for all categories is 0, where

[$p_j$ = sample (observed) proportion]{.subpoint}

[$\pi_j$ = expected (population) proportion]{.subpoint}

$H_A$: $p_j – \pi_j \neq 0$ for all categories $j$


## $\chi^2$ Test of Independence Generally

$$ \chi^2 = \sum_{j_1=0}^{J_1}\sum_{j_2=0}^{J_2} \frac{(y_j – N\pi_j)^2}{N\pi_j} = \sum_{j_1=0}^{J_1}\sum_{j_2=0}^{J_2} \frac{(y_j – m_j)^2}{m_j} $$

Basically identical formula to calculate the $\chi^2$.

The difference is that our expected frequencies $m_j$ are derived from the data. Just like before, we calculate the difference from each cell, but now we have two categories that make up the cell.

*The sum of the squared differences between the observed and expected frequencies, divided by the expected frequency, for each cell*


## $\chi^2$ Test of Independence Cutoffs

$\text{df} = (J_1 - 1) \times (J_2 - 1) = J_1 \times J_2 - 2$ or

$\text{df} = (n_{rows} - 1) \times (n_{cols} - 1) = n_{rows} \times n_{cols} - 2$

What is the critical $\chi^2$ value in a test of independence for a 3x2?

```{r}
df <- (3 - 1) * (2 - 1)
df
qchisq(.95, df)
```


## $\chi^2$ Test of Proportions Example

You are another educational psychologist, and you're interested in examining your department's student body makeup. You wonder whether there is an association between students' level (graduate vs. undergraduate) and whether they are an in-state student or not. You sample 50 students from your department, and these are the frequencies you observe. 

[First, what are your expected frequencies for each category?]{.fragment}

```{r}
#| echo: false
data.frame(type = c("Undergrad", "Graduate"),
           `In-State` = c(25, 5),
           `Out-of-State` = c(10, 10)) |>
  gt(rowname_col = "type") |>
  cols_label(`In.State` = "In-State",
             `Out.of.State` = "Out-of-State") |>
  tab_style(style = cell_text(weight = "bold"),
              locations = list(cells_column_labels(), cells_stub())) |>
  sub_missing(missing_text = "")
```


## $\chi^2$ Test of Proportions Example: Calculating Expected Frequencies

First, get the marginal totals for each column

```{r}
#| echo: false
data.frame(type = c("Undergrad", "Graduate", "Total"),
           `In-State` = c(25, 5, NA),
           `Out-of-State` = c(10, 10, NA),
           Total = c(NA, NA, NA)) |>
  gt(rowname_col = "type") |>
  cols_label(`In.State` = "In-State",
             `Out.of.State` = "Out-of-State") |>
  tab_style(style = cell_text(weight = "bold"),
              locations = list(cells_column_labels(), cells_stub())) |>
  tab_style(style = cell_text(color = "steelblue3", style = "italic"),
              locations = list(cells_column_labels(columns = "Total"),
                               cells_body(columns = "Total"),
                               cells_body(rows = In.State >= 30),
                               cells_stub(rows = "Total"))) |>
  sub_missing(missing_text = "")
```


## $\chi^2$ Test of Proportions Example: Calculating Expected Frequencies

```{r}
#| echo: false
data.frame(type = c("Undergrad", "Graduate", "Total"),
           `In-State` = c(25, 5, 30),
           `Out-of-State` = c(10, 10, 20),
           Total = c(35, 15, 50)) |>
  gt(rowname_col = "type") |>
  cols_label(`In.State` = "In-State",
             `Out.of.State` = "Out-of-State") |>
  tab_style(style = cell_text(weight = "bold"),
              locations = list(cells_column_labels(), cells_stub())) |>
  tab_style(style = cell_text(color = "steelblue3", style = "italic"),
              locations = list(cells_column_labels(columns = "Total"),
                               cells_body(columns = "Total"),
                               cells_body(rows = In.State >= 30),
                               cells_stub(rows = "Total"))) |>
  sub_missing(missing_text = "")
```


Expected cell frequency = marginal column proportion $\times$ marginal row proportion

* Undergrad & In-State = $\frac{35}{50} \times \frac{30}{50} \times 50 = 21$

* Undergrad & Out-of-State = $\frac{35}{50} \times \frac{20}{50} \times 50 = 14$

* Graduate & In-State = $\frac{15}{50} \times \frac{30}{50} \times 50 = 9$

* Graduate & Out-of-State = $\frac{15}{50} \times \frac{20}{50} \times 50 = 6$

```{r}
#| echo: false
#| layout-ncol: 2
data.frame(type = c("Undergrad", "Graduate", "Total"),
           `In-State` = c(25, 5, 30),
           `Out-of-State` = c(10, 10, 20),
           Total = c(35, 15, 50)) |>
  gt(rowname_col = "type") |>
  cols_label(`In.State` = "In-State",
             `Out.of.State` = "Out-of-State") |>
  tab_style(style = cell_text(weight = "bold"),
              locations = list(cells_column_labels(), cells_stub())) |>
  tab_style(style = cell_text(color = "steelblue3", style = "italic"),
              locations = list(cells_column_labels(columns = "Total"),
                               cells_body(columns = "Total"),
                               cells_body(rows = In.State >= 30),
                               cells_stub(rows = "Total"))) |>
  sub_missing(missing_text = "")

data.frame(type = c("Undergrad", "Graduate", "Total"),
           `In-State` = c(21, 9, 30),
           `Out-of-State` = c(14, 6, 20),
           Total = c(35, 15, 50)) |>
  gt(rowname_col = "type") |>
  cols_label(`In.State` = "In-State",
             `Out.of.State` = "Out-of-State") |>
  tab_style(style = cell_text(weight = "bold"),
              locations = list(cells_column_labels(), cells_stub())) |>
  tab_style(style = cell_text(color = "steelblue3", style = "italic"),
              locations = list(cells_column_labels(),
                               cells_body(),
                               cells_stub())) |>
  sub_missing(missing_text = "")
```


## $\chi^2$ Test of Proportions Example

$$ \chi^2 = \sum_{j=0}^{J} \frac{(y_j – N\pi_j)^2}{N\pi_j} = \sum_{j=0}^{J} \frac{(y_j – m_j)^2}{m_j} $$

```{r}
data.frame(type = c("Undergrad", "Graduate", "Total"),
           `In-State` = c(25, 5, 30),
           `Out-of-State` = c(10, 10, 20),
           Total = c(35, 15, 50)) 

chisq_crit <- qchisq(.95, df = (2 - 1) * (2 - 1))

obs_chisq <- (25 - 21)^2 / 21 +
  (10 - 14)^2 / 14 +
  (5 - 9)^2 / 9 +
  (10 - 6)^2 / 6
obs_chisq

obs_chisq > chisq_crit
```

## $\chi^2$ Test of Independence R Function

:::: {.columns}
::: {.column width="50%"}
```{r}
studdat <- data.frame(type = c("Undergrad", "Graduate"),
           `In-State` = c(25, 5),
           `Out-of-State` = c(10, 10))
studdat |>
  select(-type) |>
  chisq.test(correct = F)
```
:::

::: {.column width="50%"}
[○ `correct` = [`T`/`F`], applies a "continuity correction" to the $\chi^2$ value. Default is `T`. Change to `F`!]{.subpoint}
:::
::::

[We can reject the null in favor of the alternative that students' level (graduate vs. undergraduate) and whether they are an in-state student or not have some association.]{.fragment}


# Assignment 12











